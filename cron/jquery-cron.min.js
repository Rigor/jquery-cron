!function(t){function e(t){return' <option value="'+t.value+'">'+t.text+"</option> "}function n(t){return' <span class="'+t["class"]+'">'+t.text+"</span> "}function a(t){t=t||{};var e='title="'+(t.title||"")+'"',o='name="'+(t.name||"")+'"',n='class="'+(t["class"]||"")+'"',a=t.data||"",r=t.text||"",i=t.multiple?' multiple="multiple" ':"";return" <select "+[e,o,n,a,i].join(" ")+">"+r+"</select>"}function r(t){for(var o="",n=0;n<t.length;n++)o+=e({text:t[n],value:t[n]});return o}function i(e,o){var o=o||{},n=o.initial,a=o.rails;try{if(t(e).timezones(),a){var r=t(e).find("option");t.each(r,function(e,o){var n=t(o),a=RailsTimeZone.to(n.val());a?(n.text("(GMT"+n.data("offset")+") "+a),n.val(a)):n.remove()})}t("select[name=cron-timezone]").val(n||moment().zone()),o["class"]&&t("select[name=cron-timezone]").addClass(o["class"])}catch(i){throw"Timezones not loaded! Make sure your options are correct and all necessary libraries are loaded.\nhttp://www.jqueryscript.net/time-clock/Easy-Timezone-Picker-with-jQuery-Moment-js-Timezones.html\n"+i.message}}function s(t){return"undefined"==typeof t?!1:!0}function d(t){return!s(t)||"object"==typeof t}function m(e,n){if(s(n.customValues))for(key in n.customValues)if(e==n.customValues[key])return key;var a=/^(((L|\d{1,2})(,\d{1,2})*(,L)?|\*)\s){4}(\d{1,2}(,\d{1,2})*|\*)$/;if("string"!=typeof e||!a.test(e))return void t.error("cron: invalid initial value");for(var r=e.split(" "),i=[0,0,1,1,0],d=[59,23,31,12,6],m=0;m<r.length;m++)if("*"!=r[m]){var l=parseInt(r[m]);if(isNaN(l)){if("L"===r[m])continue}else if(s(l)&&l<=d[m]&&l>=i[m])continue;return void t.error("cron: invalid value found (col "+(m+1)+") in "+o.initial)}for(var c in V)if(V[c].test(e))return c;return void t.error("cron: valid but unsupported cron format. sorry.")}function l(e,o){if(!s(m(o.initial,o)))return!0;if(!d(o.customValues))return!0;if(s(o.customValues))for(key in o.customValues)if(V.hasOwnProperty(key))return t.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0;return!1}function c(e){var o=e.period.find("select").val(),n={min:"*",hour:"*",day:"*",month:"*",dow:"*",selectedPeriod:o},a={minute:["mins"],day:["min","hour"],week:["min","hour","dow"],month:["min","hour","day"],year:["min","hour","day","month"]},r={mins:e.mins.find("select").val(),min:e.time.find("select[name=cron-time-min]").val(),hour:e.time.find("select[name=cron-time-hour]").val(),day:e.dom.find("select").val(),month:e.month.find("select").val(),dow:e.dow.find("select").val()};if(j){var i="pm"==e.time.find("select[name=cron-time-am-pm]").val();i&&(r.hour=parseInt(r.hour)+12)}return a[o]?(t.each(a[o],function(t,e){var o=n[e];n[e]=r[e]||o}),n):o}function u(t){var e=t.data("block"),o=c(e);return[o.min,o.hour,o.day,o.month,o.dow].join(" ")}for(var p=["minute","hour","day","week","month","year"],h=r(p),v="",f=0;60>f;f++){var O=10>f?"0":"";v+=e({text:O+f,value:f})}for(var y="",f=0;24>f;f++){var O=10>f?"0":"";y+=e({text:O+f,value:f})}for(var x="",f=1;12>=f;f++){var O=10>f?"0":"";x+=e({text:O+f,value:f%12})}for(var b=r(["am","pm"]),k="",f=1;32>f;f++){if(1==f||21==f||31==f)var g="st";else if(2==f||22==f)var g="nd";else if(3==f||23==f)var g="rd";else var g="th";k+=e({text:f+g,value:f})}k+=e({text:"last day of the month",value:"L"});for(var w="",z=["January","February","March","April","May","June","July","August","September","October","November","December"],f=0;f<z.length;f++)w+=e({text:z[f],value:f+1});for(var C="",T=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],f=0;f<T.length;f++)C+=e({text:T[f],value:f});var M={minute:[],hour:["mins"],day:["time","timezone"],week:["dow","time","timezone"],month:["dom","time","timezone"],year:["dom","month","time","timezone"]},V={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}(,\d{1,2})*\s(\*\s){3}\*$/,day:/^(\d{1,2}(,\d{1,2})*\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}(,\d{1,2})*\s){2}(\*\s){2}\d{1,2}(,\d{1,2})*$/,month:/^((L|\d{1,2})(,\d{1,2})*(,L)?\s){3}\*\s\*$/,year:/^((L|\d{1,2})(,\d{1,2})*(,L)?\s){4}\*$/},P={initial:"* * * * *",url_set:void 0,customValues:void 0,periods:p,periodOpts:{text:h,name:"cron-period"},minuteOpts:{text:v,name:"cron-mins"},dowOpts:{text:C,name:"cron-dow"},domOpts:{text:k,name:"cron-dom"},monthOpts:{text:w,name:"cron-month"},timeHourOpts:{text:y,name:"cron-time-hour"},timeMinuteOpts:{text:v,name:"cron-time-min"},timeAmPmOpts:{text:b,name:"cron-time-am-pm"},timezoneOpts:{enabled:!1},onChange:void 0,afterCreate:void 0},j=!1,A={init:function(o){var d=o?o:{},m=t.extend([],P,d);t.extend(m,{periodOpts:t.extend({},P.periodOpts,d.periodOpts),minuteOpts:t.extend({},P.minuteOpts,d.minuteOpts),domOpts:t.extend({},P.domOpts,d.domOpts),monthOpts:t.extend({},P.monthOpts,d.monthOpts),dowOpts:t.extend({},P.dowOpts,d.dowOpts),timeHourOpts:t.extend({},P.timeHourOpts,d.timeHourOpts),timeMinuteOpts:t.extend({},P.timeMinuteOpts,d.timeMinuteOpts),timeAmPmOpts:t.extend({},P.timeAmPmOpts,d.timeAmPmOpts),timezoneOpts:t.extend({},P.timezoneOpts,d.timezoneOpts)});var c=r(m.periods);t.extend(m.periodOpts,{text:c});var u="",p=m.customValues;if(s(p)){for(var h in p)u+=e({text:h,value:p[h]});t.extend(m.periodOpts,{text:u+c})}if(l(this,m))return this;var v=[],f=a(m.periodOpts);v.period=t(n({text:"Every "+f,"class":"cron-period"})).appendTo(this).data("root",this);var O=v.period.find("select");O.bind("change.cron",L.periodChanged).data("root",this);var y=a(m.domOpts);v.dom=t(n({text:" on the "+y,"class":"cron-block cron-block-dom"})).appendTo(this).data("root",this),O=v.dom.find("select").data("root",this);var b=a(m.monthOpts);v.month=t(n({text:" of "+b,"class":"cron-block cron-block-month"})).appendTo(this).data("root",this),O=v.month.find("select").data("root",this);var k=a(m.minuteOpts);v.mins=t(n({text:" at "+k+" minutes past the hour ","class":"cron-block cron-block-mins"})).appendTo(this).data("root",this),O=v.mins.find("select").data("root",this);var g=a(m.dowOpts);v.dow=t(n({text:" on "+g,"class":"cron-block cron-block-dow"})).appendTo(this).data("root",this),O=v.dow.find("select").data("root",this);var w="";m.twelve_hour_format&&(j=!0,m.timeHourOpts.text=x,w=a(m.timeAmPmOpts),t(w).val("am"));var z=a(m.timeHourOpts),k=a(m.timeMinuteOpts);if(v.time=t(n({text:" at "+z+":"+k+" "+w,"class":"cron-block cron-block-time"})).appendTo(this).data("root",this),O=v.time.find("select[name=cron-time-hour]").data("root",this),O=v.time.find("select[name=cron-time-min]").data("root",this),O=v.time.find("select[name=cron-time-am-pm]").data("root",this),m.timezoneOpts.enabled){var C=a({text:"",name:"cron-timezone"});v.timezone=t(n({text:" in the timezone "+C,"class":"cron-block cron-block-timezone"})).appendTo(this).data("root",this),O=v.timezone.find("select").data("root",this),i(O,m.timezoneOpts)}var T=n({"class":"cron-button cron-button-save"});v.controls=t(n({text:" &laquo; save "+T,"class":"cron-controls"})).appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",L.saveClicked).data("root",this).end();var M=m.afterCreate;return s(M)&&t.isFunction(M)&&M(),this.find("select").bind("change.cron-callback",L.somethingChanged),this.data("options",m).data("block",v),this.data("current_value",m.initial),A.value.call(this,m.initial)},value:function(t){if(!t)return u(this);var e=this.data("options"),o=this.data("block"),n=m(t,e);if(!s(n))return!1;if(s(e.customValues)&&e.customValues.hasOwnProperty(n))n=e.customValues[n];else for(var a=t.split(" "),r={mins:a[0],hour:a[1],dom:a[2],month:a[3],dow:a[4]},i=M[n],d=0;d<i.length;d++){var l=i[d];if("time"==l){var c=o[l];if(j){var p=parseInt(r.hour),h=p>=12;h&&(o[l].find("select[name=cron-time-am-pm]").val("pm"),r.hour=p-12)}var c=o[l].find("select[name=cron-time-hour]").val(r.hour);c=o[l].find("select[name=cron-time-min]").val(r.mins)}else if("timezone"!==l){var c=o[l].find("select");c.attr("multiple")&&(r[l]=r[l].split(",")),c.val(r[l])}}var v=o.period.find("select").val(n);return v.trigger("change"),this},timezone:function(){var t=this.data("block").timezone.find("select[name=cron-timezone]");return t.val()},timezoneOffset:function(){var t=this.data("block").timezone.find("select[name=cron-timezone]"),e=t.find("option:selected").data("offset");return e}},L={periodChanged:function(){var e=t(this).data("root"),o=e.data("block"),n=e.data("options"),a=t(this).val();if(e.find("span.cron-block").hide(),M.hasOwnProperty(a))for(var r=M[t(this).val()],i=0;i<r.length;i++)("timezone"!==r[i]||n.timezoneOpts.enabled)&&o[r[i]].show()},somethingChanged:function(){root=t(this).data("root"),s(root.data("options").url_set)?A.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var e=root.data("options").onChange;s(e)&&t.isFunction(e)&&e.call(root)},saveClicked:function(){var e=t(this),o=e.data("root"),n=A.value.call(o);e.hasClass("cron-loading")||(e.addClass("cron-loading"),t.ajax({type:"POST",url:o.data("options").url_set,data:{cron:n},success:function(){o.data("current_value",n),e.removeClass("cron-loading"),n==A.value.call(o)&&(o.removeClass("cron-changed"),o.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?"),e.removeClass("cron-loading")}}))}};t.fn.cron=function(e){return A[e]?A[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error("Method "+e+" does not exist on jQuery.cron"):A.init.apply(this,arguments)}}(jQuery);
